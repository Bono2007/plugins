var exports=function(t){"use strict";async function e(t,e="OK"){await CommandBar.showOptions([e],t)}const n="\\d{4}-[01]\\d{1}-\\d{2}";function o(t){if(null==t||isNaN(t))return"";let e="",n=t,o=!1;return n<0&&(n=Math.abs(n),o=!0),e=1===n||n<9?"".concat(n,"d"):n<12||n<29?"".concat(Math.round(n/7),"w"):n<550?"".concat(Math.round(n/30.4),"m"):"".concat(Math.round(n/365),"y"),e=0===n?"today":o?"**".concat(e," ago**"):"in ".concat(e),e}(new Date).toISOString().slice(0,10),(new Date).toISOString().slice(0,16),null==DataStore.defaultFileExtension||DataStore.defaultFileExtension;async function i(){console.log("getNextNoteToReview")}async function a(){var t;const e="@reviewed",o="".concat(e,"\\(").concat(n,"\\)"),i="".concat(e,"(").concat(function(t){const{year:e,month:n,date:o}=function(t){return{year:t.getFullYear(),month:t.getMonth()+1,date:t.getDate()}}(t);return"".concat(e,"-").concat(n<10?"0":"").concat(n,"-").concat(o<10?"0":"").concat(o)}(new Date),")");if(null==Editor.note||"Calendar"===Editor.note.type)return;let a;const c=null===(t=Editor.note)||void 0===t?void 0:t.mentions.find((t=>t.match(o)));if(null!=c){const t=c;for(const t of Editor.paragraphs)t.content.match(o)&&(a=t,console.log("\tFound existing ".concat(e,"(date) in line ").concat(t.lineIndex)));if(null==a)return null;const n=a,s=n.content.replace(t,i);n.content=s,console.log("\tupdating para to '".concat(s,"'")),await Editor.updateParagraph(n)}else{var s;console.log("\tno matching ".concat(e,"(date) string found. Will append to line ").concat(1));const t=null===(s=Editor.note)||void 0===s?void 0:s.paragraphs[1];if(null==t)return null;const n=t;n.content+=" ".concat(i),await Editor.updateParagraph(n)}return Editor.note}function c(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const s="Summaries";function l(t,e){let n;n=null!=e?DataStore.projectNotes.slice().filter((t=>t.filename.startsWith("".concat(e,"/")))):DataStore.projectNotes.slice();return n.filter((e=>e.hashtags.includes(t)))}const r="(".concat(n,")");function d(t,e){return null!=t?function(t,e){const n=new Date(t);let o=0,i=0,a=0;const c=e.charAt(e.length-1);let s=Number(e.substr(0,e.length-1));switch(c){case"b":{const t=n.getUTCDay();let e;e=s<0?(t-12)%7:(t+6)%7,6===e&&s--,-6===e&&s++,o=s+2*Math.trunc((s+e)/5);break}case"d":o=s;break;case"w":o=7*s;break;case"m":i=s;break;case"q":i=3*s;break;case"y":a=s;break;default:console.log("\tInvalid date interval: '".concat(e,"'"))}return o>0?Calendar.addUnitToDate(n,"day",o):i>0?Calendar.addUnitToDate(n,"month",i):a>0?Calendar.addUnitToDate(n,"year",a):n}(t.toISOString().slice(0,10),e):new Date}function u(t,e){const n=t.filter((t=>t.startsWith("".concat(e,"("))));return n.length>0?n[0]:""}function h(t,e){const n=t.filter((t=>t===e));return n.length>0?n[0]:""}function v(t){var e;if(""===t)return;const n=null!==(e=t.match(r))&&void 0!==e?e:[];if(n[1].length>0){return new Date(Number(n[1].slice(0,4)),Number(n[1].slice(5,7))-1,Number(n[1].slice(8,10)))}}function m(t,e){return Math.round((e-t)/1e3/60/60/24)}class f{constructor(t){var e;c(this,"note",void 0),c(this,"title",void 0),c(this,"dueDate",void 0),c(this,"dueDays",void 0),c(this,"reviewedDate",void 0),c(this,"reviewInterval",void 0),c(this,"nextReviewDate",void 0),c(this,"nextReviewDays",void 0),c(this,"completedDate",void 0),c(this,"completedDays",void 0),c(this,"isCompleted",void 0),c(this,"openTasks",void 0),c(this,"completedTasks",void 0),c(this,"waitingTasks",void 0),c(this,"isArchived",void 0),c(this,"isActive",void 0),c(this,"noteType",void 0);const n=t.mentions,o=t.hashtags;this.note=t,this.title=null!==(e=t.title)&&void 0!==e?e:"(error)",this.dueDate=v(u(n,"@due")),this.dueDays=""!==this.dueDate?m(new Date,this.dueDate):void 0,this.reviewedDate=v(u(n,"@reviewed")),this.reviewInterval=function(t){var e;if(""===t)return;const n=null!==(e=t.match("\\((.*?)\\)"))&&void 0!==e?e:[];return n[1].length>0?n[1]:void 0}(u(n,"@review")),this.nextReviewDate=null!=this.reviewedDate&&null!=this.reviewInterval?d(this.reviewedDate,this.reviewInterval):null,this.nextReviewDays=""!==this.nextReviewDate?m(new Date,this.nextReviewDate):void 0,this.completedDate=v(u(n,"@completed")),this.completedDays=""!==this.completedDate?m(new Date,this.completedDate):void 0,this.openTasks=t.paragraphs.filter((t=>"open"===t.type)).length,this.completedTasks=t.paragraphs.filter((t=>"done"===t.type)).length,this.waitingTasks=t.paragraphs.filter((t=>"open"===t.type)).filter((t=>t.content.match("#waiting"))).length,this.isCompleted=null!=this.completedDate,this.isArchived=""!==h(o,"#archive"),this.isActive=!(""===h(o,"#active")&&null==this.reviewInterval||this.isCompleted)}get decoratedProjectTitle(){var t,e,n;return this.isCompleted?"[x] [[".concat(null!==(t=this.title)&&void 0!==t?t:"","]]"):this.isActive?"[[".concat(null!==(e=this.title)&&void 0!==e?e:"","]]"):"[-] [[".concat(null!==(n=this.title)&&void 0!==n?n:"","]]")}basicSummaryLine(){var t;const e=void 0!==this.title?"[[".concat(null!==(t=this.title)&&void 0!==t?t:"","]]"):"(error)";return"- ".concat(e)}detailedSummaryLine(){let t="- ".concat(this.decoratedProjectTitle);return null!=this.completedDate?t+="\t(Completed ".concat(o(this.completedDays),")"):(t+="\to".concat(this.openTasks," / c").concat(this.completedTasks," / w").concat(this.waitingTasks),t+="/ ".concat(o(this.nextReviewDays)," / ").concat(o(this.dueDays))),t}}async function g(t){var e;const n="'".concat(t,"' notes summary");let o;const i=null!==(e=DataStore.projectNoteByTitle(n,!0,!1))&&void 0!==e?e:[];if(console.log("\tfound ".concat(i.length," existing summary notes for this period")),i.length>0)o=i[0],console.log("\tfilename of first matching note: ".concat(o.filename));else{var a;let t=await DataStore.newNote(n,s);console.log("\tnewNote filename: ".concat(String(t))),t=null!==(a="".concat(s,"/").concat(String(t)))&&void 0!==a?a:"(error)",o=await DataStore.projectNoteByFilename(t)}return o}function p(t){console.log("\nmakeNoteTypeSummary for ".concat(t));let e=0,n=0;const o=[],i=DataStore.folders;console.log("".concat(i.length," folders"));for(const a of i){const i=l(t,a);if(i.length>0){const t=[];for(const e of i){const o=new f(e);o.isArchived||t.push(o),null!=o.nextReviewDays&&o.nextReviewDays<0&&(n+=1)}let c=[];c=t.sort(((t,e)=>{var n,o;return(null!==(n=t.title)&&void 0!==n?n:"").localeCompare(null!==(o=e.title)&&void 0!==o?o:"")})),o.push("### ".concat(a," (").concat(c.length," notes)"));for(const t of c)o.push(t.detailedSummaryLine());e+=c.length}}return o.unshift("_Key:\tTitle\t# open / complete / waiting tasks / next review date / due date_"),o.unshift("Total: **".concat(e," active notes**.").concat(n>0?" (".concat(n," are overdue review)"):"")),o.unshift("Last updated: ".concat((new Date).toLocaleString())),o}return t.editorSetReviewDate=a,t.getNextNoteToReview=i,t.makeNoteTypeSummary=p,t.nextReview=async function(){console.log("nextReview: stage 1");const t=await a();if(null==t)return;console.log("nextReview: stage 2"),await async function(t){var e;null!=t&&"Calendar"!==t.type||console.log("completeReviewUpdateList: error: called with null or Calendar note type");console.log("completeReviewUpdateList for '".concat(null!==(e=t.title)&&void 0!==e?e:"","'"))}(t),console.log("nextReview: stage 3");const n=await i();null!=n?(console.log("nextReview: stage 4"),Editor.openNoteByFilename(n.filename)):(console.log("nextReview: ðŸŽ‰ No more notes to review!"),await e("ðŸŽ‰ No more notes to review!"))},t.noteTypeSummaries=async function(){console.log("\nnoteTypeSummaries");const t="#area".split(",");for(const n of t){const t=n.slice(1),o=await g(t);if(null==o)return e("Oops: failed to find or make project summary note","OK"),void console.log("makeNoteTypeSummary: error: shouldn't get here -- no valid note to write to");{const e=p(n),i="'".concat(t,"' notes summary");e.unshift(i),console.log("\twriting results to the note with filename '".concat(o.filename,"'")),o.content=e.join("\n"),console.log("\twritten results to note '".concat(i,"'"))}}},Object.defineProperty(t,"__esModule",{value:!0}),t}({});Object.assign(globalThis,exports);
